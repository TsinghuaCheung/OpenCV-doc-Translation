摄像机已经发明面世有一段时间了。然而直到20世纪后期针孔摄像机发明之后，摄像机才进入我们的日常生活当中。不幸的是，便宜也意味着性能不会太好：有明显的扭曲。幸运的是，他们通常是一个定值，并且通过修正和简单的重映射，我们就能修复它。另外，通过修正，你可以确定相机自然单位（像素）和真实世界单位（比如，毫米）之间的换算关系。

理论

对于扭曲，OpenCV通过半径和正切值做为参数来进行修正。对于半径参数，可以用以下公式：

![](http://latex.codecogs.com/gif.latex?x_%7Bdistorted%7D%20%3D%20x%28%201%20+%20k_1%20r%5E2%20+%20k_2%20r%5E4%20+%20k_3%20r%5E6%29%20%5C%5C%20y_%7Bdistorted%7D%20%3D%20y%28%201%20+%20k_1%20r%5E2%20+%20k_2%20r%5E4%20+%20k_3%20r%5E6%29)

对于在未扭曲的图像中像素点的坐标值为（x,y）,其在已经扭曲的图像中对应的坐标将是 (![](http://latex.codecogs.com/gif.latex?x_%7Bdistorted%7D%2C%20y_%7Bdistorted%7D)). 辐射扭曲的效果就好像“圆柱”和“鱼眼”特效一样。

正切扭曲是在图像在晶状体面前的时候不再和成像面平行了。它的效果由下式表达：

![](http://latex.codecogs.com/gif.latex?x_%7Bdistorted%7D%20%3D%20x%20+%20%5B%202p_1xy%20+%20p_2%28r%5E2+2x%5E2%29%5D%20%5C%5C%20y_%7Bdistorted%7D%20%3D%20y%20+%20%5B%20p_1%28r%5E2+%202y%5E2%29+%202p_2xy%5D)

因此我们就有了五个扭曲变量，这五个变量在OpenCV中用一行五列的矩阵表示：

![](http://latex.codecogs.com/gif.latex?distortion%5C_coefficients%3D%28k_1%20%5Chspace%7B10pt%7D%20k_2%20%5Chspace%7B10pt%7D%20p_1%20%5Chspace%7B10pt%7D%20p_2%20%5Chspace%7B10pt%7D%20k_3%29)

为了有统一的变换，我们有以下公式：

![](http://latex.codecogs.com/gif.latex?%5Cleft%20%5B%20%5Cbegin%7Bmatrix%7D%20x%20%5C%5C%20y%20%5C%5C%20w%20%5Cend%7Bmatrix%7D%20%5Cright%20%5D%20%3D%20%5Cleft%20%5B%20%5Cbegin%7Bmatrix%7D%20f_x%20%26%200%20%26%20c_x%20%5C%5C%200%20%26%20f_y%20%26%20c_y%20%5C%5C%200%20%26%200%20%26%201%20%5Cend%7Bmatrix%7D%20%5Cright%20%5D%20%5Cleft%20%5B%20%5Cbegin%7Bmatrix%7D%20X%20%5C%5C%20Y%20%5C%5C%20Z%20%5Cend%7Bmatrix%7D%20%5Cright%20%5D)

在这里，w代表的是在单应性坐标系统的使用（并且w=Z）。未知参数是![](http://latex.codecogs.com/gif.latex?f_x) and ![](http://latex.codecogs.com/gif.latex?f_y) （相机焦距）和![](http://latex.codecogs.com/gif.latex?(c_x,c_y)) 这个表示的是像素坐标系中的视觉中心。如果所有的坐标轴都有一个共同的焦距，焦距使用的纵横比（通常为一），然后![](http://latex.codecogs.com/gif.latex?f_y=f_x*a)以及之前的公式中，我们将会使用一个单焦距f来计算。这个矩阵包含了四个变量，这四变量被认为是相机矩阵。当无论相机使用了什么分辨率，扭曲参数都不变的时候，那么当前分辨率和修正分辨率之间是成比率关系。

在这两个矩阵之间确定某种联系的过程就叫做图像纠正。这些变量的纠正通过基本几何方程来完成的。方程的选定取决于选取的纠正物体。目前OpenCV支持一下物体的纠正：

* 传统的黑白棋盘
* 对称圆模型
* 非对称圆模型

你基本上需要通过相机先拍一张快照，然后通过OpenCV来确定模型。每一种确定的模型都是一条新的公式。为了确定这些公式中的参数，你至少需要在一个已经处理好的公示系统中预先确定公式中的一个参数。如果这个数字越大，说明我们应该选择棋盘模型，反之，应该选择圆形模型。例如，棋盘模型至少要两张图片。然而，实际上在我们的输入图片中会有大量的噪声，因此为了得到最好的结果，你至少要在不同的地方拍十张照片。

目的

这个简单的程序将会:

* 确定扭曲矩阵
* 确定相机矩阵
* 从相机、视频和图片文件中获得图像
* 从XML/YAML文件中获取配置
* 将结果存储到XML/YAML文件中
* 计算重投影的误差