目的

从这篇教程中，你将会学习到：

* 使用两种非常常用的形态学操作（如侵蚀和扩张），使用自定义的核，这样就能直接提取到垂直和水平方向的直线。为了能够达到这一目的，你需要以下OpenCV函数：

    * erode()
    * dilate()
    * getStructuringElement()

接下来的例子中，你将会知道如何从乐谱中提取出音符。

理论

形态学操作

形态学是一系列基于预定义元素（同时也被称作核）的图像处理技术。每一个输出图像像素的值都基于输入函数对应像素的临近像素之间的比较。当你选择了核的大小和形状以后，你就可以对输入图像创建一种基于特定形状的形态学操作。

两种最基本的形态学操作是侵蚀和扩张。侵蚀会将图像中目标对象的像素加载物体的边缘上，而扩张则正好相反。增加或减少像素的数量基于对图像处理中使用的预定义元素大小和形状。通常情况下，这两个操作的规则是：

* 侵蚀：将所有预先定义的形状元素大小和形状内的像素值全部计算出来，找到最大值，并作为输出像素值。例如，在二值图里，如果所有落在规定区域内的输入图像像素值都为1，那么对应输出像素的值也会被设置为1。后面提高的计算情况适用于任何类型的图片（例如，灰阶图，三色图等）。

![](https://docs.opencv.org/4.1.0/morph21.gif)

Dilation on a Binary Image

![](https://docs.opencv.org/4.1.0/morph6.gif)

Dilation on a Grayscale Image

* 扩张：这项操作正好与侵蚀相反。将所有预先定义的形状元素大小和形状内的像素值全部计算出来，找到最小值，并作为输出像素值。可以观察以下图形：

![](https://docs.opencv.org/4.1.0/morph211.png)

Erosion on a Binary Image

![](https://docs.opencv.org/4.1.0/morph61.png)

Erosion on a Grayscale Image

结构性元素

从之前的教程中看出，任何形态学操作当中，结构性元素用来处理图像，它是最重要的一部分。

结构性元素是一只个包含了0和1的矩阵，这个元素可以有不同的形状和大小。通常情况下，结构性元素比需要处理的图片要小，1表示的是邻近元素。我们将结构性元素的中心元素称之为原点，确定了我们感兴趣的像素，也就是需要处理的元素。

例如，下面的图像表示的是一个六边形大小的结构性元素，它的大小是7x7。

![](https://docs.opencv.org/4.1.0/morph12.gif)

A Diamond-Shaped Structuring Element and its Origin

结构性元素可以有各种各样的形状，线条、六边形、碟片、周期型线条或者是圆。通常情况下你会设置一个和输入图片中需要处理/扩大的物体一样大小和形状的结构性元素。