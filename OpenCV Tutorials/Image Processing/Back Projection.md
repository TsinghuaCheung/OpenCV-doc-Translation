目的

在本教程中，你将会学到：

* 什么是反向映射，他为什么那么重要
* 如何使用OpenCV的cv::calcBackProject函数来计算反向映射
* 通过OpenCV的cv::mixChannels函数来混合不同的色彩通道

理论

什么是反向映射？

* 反向映射是一种能够在直方图模式下显示给定图片的像素与像素分布之间的相似程度的算法。
* 简而言之：对于反向映射，你可以将一个图形特征进行直方图显示，并通过它在一个图像中找到某种特征。
* 应用层例子：如果你在肉色中显示直方图（或者说色调——饱和度直方图），你就可以通过反向映射的方式找到图像中的皮肤：

他是如何工作的？

* 我们通过检测皮肤的例子来说明情况：
* 假如，你获得了一张肉色（色调饱和度）图片，就像下图这样的。我们的标准直方图就是旁边所展示的那样（我们由此可以知道，这是皮肤调性图片样例）。你可以用一些蒙版来获得只属于皮肤区域的直方图：

![](https://docs.opencv.org/4.1.0/Back_Projection_Theory0.jpg)
T0

![](https://docs.opencv.org/4.1.0/Back_Projection_Theory1.jpg)
T1

* 现在，就像假设一下，你获得了另外一张手的照片（测试照片），就像下图那样：（还有他的直方图）

![](https://docs.opencv.org/4.1.0/Back_Projection_Theory2.jpg)
T2
![](https://docs.opencv.org/4.1.0/Back_Projection_Theory3.jpg)
T3

* 当前我们需要做的便是用我们的直方图模型（这是代表手的直方图）去检测在测试图片中的批复区域范围。我们有以下步骤：
    
    1.在我们测试图片的每个像素（p(i,j)）中，我们将这些数据都收集起来，并找到对应像素的二值位置 ((![](http://latex.codecogs.com/gif.latex?h_{i,j},s_{i,j)) )。
    2.查看标准直方图的对应二值位置(![](http://latex.codecogs.com/gif.latex?h_{i,j},s_{i,j))并读取二值位置。
    3.在新的图片中保存二值（反向映射）。同时，你可以考虑先将标准直方图进行归一化处理，这样对于测试图片而言，输出的像素之都在可见范围内。
    4.经过了上述步骤，我们就测试图片得到了以下反向映射图片：

    ![](https://docs.opencv.org/4.1.0/Back_Projection_Theory4.jpg)

    5.在统计学中，反向映射图中存储的值表示的是测试图片中一个像素属于皮肤区域的概率，这个概率基于我们使用的标准直方图。例如，在我们的测试用例中，更亮的部分可能是测试图片中的皮肤区域（他们也确实是），而较暗的部分则可能不是（注意到，一些“较暗”部分可能是皮肤的阴影部分，这会影响监测的效果）。